# Конфигурация PortSentry
# (обычно расположен в /etc/portsentry/portsentry.conf)
#
# $Id: portsentry.conf.Debian,v 1.6 2001/07/19 21:02:20 agx Exp $
#
# Оригинальный portsentry.conf -- Крейг Роуленд <crowland@psionic.com>
# Изменено для Debian -- Гвидо Гюнтер <agx@debian.org>
# Перевод и адаптация для Школы 21 -- Сергей Еремин <erjemin@gmail.com>
#
# ВАЖНОЕ ЗАМЕЧАНИЕ: Вы НЕ МОЖЕТЕ ставить пробелы между номерами
# портов.
#
# По умолчанию настройки портов позволяют захватывать большое количество
# основных проверок
#
# Все элементы должны быть в кавычках.


########################
# Конфигурации портов  #
########################
#
#
# Несколько примеров настроек для классического и основного Stealth-режима
#
# Мне всегда нравилотся всегда сохранить некоторые порты в нижнем конце диапазона.
# Это позволит быстро обнаружить последовательное сканирование портов
# и обычно эти порты не используются (например, tcpmux порт 1)
#
# **Пользователи X-Windows**: Если запускаете иксы (X) на сервере,
# нужно быть уверенным, что PortSentry не привязан к порту 6000 (или 2000 для
# пользователей OpenWindows). Это не позволит корректно запускать X-клиент.
#
# Эти привязки портов *игнорируются* для расширенного режима обнаружения скрытого
# сканирования (Advanced Stealth Scan Detection Mode).
#
# Раскомментируйте это для чрезвычайного анализа:
#TCP_PORTS="1,7,9,11,15,70,79,80,109,110,111,119,138,139,143,512,513,514,515,540,635,1080,1524,2000,2001,4000,4001,5742,6000,6001,6667,12345,12346,20034,27665,30303,32771,32772,32773,32774,31337,40421,40425,49724,54320"
#UDP_PORTS="1,7,9,66,67,68,69,111,137,138,161,162,474,513,517,518,635,640,641,666,700,2049,31335,27444,34555,32770,32771,32772,32773,32774,31337,54321"
#
# Используйте, если вы просто хотите знать:
TCP_PORTS="1,11,15,79,111,119,143,540,635,1080,1524,2000,5742,6667,12345,12346,20034,31337,32771,32772,32773,32774,40421,49724,54320"
UDP_PORTS="1,7,9,69,161,162,513,635,640,641,700,32770,32771,32772,32773,32774,31337,54321"
#
# Используйте, для поверхнотного анализа:
#TCP_PORTS="1,11,15,110,111,143,540,635,1080,1524,2000,12345,12346,20034,32771,32772,32773,32774,49724,54320"
#UDP_PORTS="1,7,9,69,161,162,513,640,700,32770,32771,32772,32773,32774,31337,54321"

# #####################################################
# Расширенные опции обнаружения скрытого сканирования #
#######################################################
#
# Это номера портов, , которые вы хотите, чтобы PortSentry отслеживал
# в расширенном режиме (Advanced mode). Любые порты *ниже* этого числа будут
# контролироваться. Прямо сейчас просматривается все ниже 1024.
#
# Во многих системах Linux вы не можете привязать порт 61000 (и выше).
# Это связано с тем, что эти порты используются как часть маскировки IP (маскарадинг).
# Не рекомендуется привязываться к этим номерам портов. В действительности:
# НЕ РЕКОМЕНДУЕТСЯ МОНИТОРИТЬ ДАЛЬШЕ 1024 ПОРТА, ЭТО ПРИВОДИТ К ЛОЖНЫМ ТРЕВОГАМ!
#
#
ADVANCED_PORTS_TCP="1024"
ADVANCED_PORTS_UDP="1024"
#
# Это поле сообщает PortSentry, какие номера портов (кроме прослушиваемых демонов)
# СЛЕДУЕТ ИГНОРИРОВАТЬ. Это полезно для служб, типа ident, которые ищут сервисы,
# типа FTP, SMTP и оболочки (wrappers), но вы не запускаете (и, скорее всего,
# *не должны* имхо).
#
# При указании здесь портов PortSentry просто не будет отвечать на входящие запросы,
# хотя в действительности PortSentry обрабатывает их, как если бы они были
# действительными связанными демонами. Порты по умолчанию считаются проблемными
# и источник ложных тревогам и, скорее всего, такие должны должны быть оставлены
# в покое для большинства случаев, кроме самых изолированных систем/сетей.
#
# TCP:
# • порт 113 -- ident (старая система идентификации, до сих пор используется в IRC-серверах)
# • порт 139 -- NetBIOS-SSN (служба сессий NetBIOS)
ADVANCED_EXCLUDE_TCP="113,139"
# UDP:
# • порт 520 -- локальный route-процесс маршрутизации, разновидность протокола Xerox NS (RIP)
# • порт 138 -- NetBIOS-DGM (служба датаграмм NetBIOS)
# • порт 137 -- NetBIOS-NM (служба имен NetBIOS)
# • порт 67  -- BOOTPS (Bootstrap Protocol Server загрузки бездисковых рабочих станций и DHCP)
# • порт 161 -- SNMP (Simple Network Management Protocol, порт прослушивания агентами удалённого
#               мониторинга и, в том числе, сканерами антивирусов)
ADVANCED_EXCLUDE_UDP="520,138,137,67,161"


##########################
# Конфигурационные файлы #
##########################
#
# в этом файле игнорируемые компьютеры
IGNORE_FILE="/etc/portsentry/portsentry.ignore"
# Хосты, которым было отказано в доступе (из истории работы)
HISTORY_FILE="/var/lib/portsentry/portsentry.history"
# Хосты, доступ которым заблокирован в текущей сессии (времмено, до следующей перезагрузки)
BLOCKED_FILE="/var/lib/portsentry/portsentry.blocked"

##################################
# Разное: Параметры конфигурации #
##################################
#
# Разрешение DNS-имен -- при установке значения «1» включается поиск имен атакующих
# хостов через DNS. Установка в «0» (или любое другое значение) отключит его.
RESOLVE_HOST="0"


#################
# Опции ответов #
#################
# Варианты "выпиливания" злоумышленника. Каждое действие будет выполнено, если обнаружена
# атака. Если вам не нужен конкретный вариант, закомментируйте его, и он будет пропущен.
#
# При обнаружении атаки переменная $TARGET$ будет заменена целевым атакующим хостом.
# Переменная $PORT$ будет заменена портом, который был отсканирован.
#
#######################
# Опции игнорирования #
#######################-------------------------------------------------------------------------
# Эти опции позволяют вам допустить автоматический параметры ответа для
# UDP/TCP. Это бывает полезно, если вы хотите получить предупреждение о
# соединениях, но не хоти реагировать на определенный протокол.
# Для предотвращения возможных Denial of service атак через UDP и
# определение stealth сканирования для TCP, вы можете пожелать отключить
# блокирование, но оставить предупреждение.
# Лично я предпочитаю ждать начала возникновения проблем до того как
# что-нибудь предпринять, так как большинство атакующих ничего не делают.
# Третья опция позволяет вам запускать внешнюю команду в случае
# сканирования. Это может быть полезно, например, для администраторов,
# которые хотят блокировать TCP, но для UDP будет высылаться
# предупреждения и т.д.
#
#
# 0 = Не блокировать UDP/TCP сканирование.
# 1 = Блокировать UDP/TCP сканирование.
# 2 = Запуск внешней команды (KILL_RUN_CMD)
BLOCK_UDP="1"
BLOCK_TCP="1"
###################
# Сброс маршрутов  #
###################
# Эти команды используются для удаления маршрута или
# хоста в локальную таблицу фильтрации.
#
# Шлюз (333.444.555.666) идеально должен быть неработающий хост
# в локальной подсети. На некоторых хостах вместо него используется
# localhost (127.0.0.1), что дает тот же эффект. ЗАМЕТИМ ЧТО
# 333.444.555.66  НЕ БУДЕТ РАБОТАТЬ, ИЗМЕНИТЕ ЭТО!!
#
# ВСЕ ОПЦИИ ОТКЛЮЧЕНИЯ МАРШРУТОВ ИЗНАЧАЛЬНО
# ЗАКОММЕНТИРОВАНЫ. Убедитесь, что вы раскомменировали
# правильные строки для вашей ОС. Если вашей ОС нет в списке
# и вы точно знаете команды сбрасывающие  маршруты, то,
# пожалуйста, пришлите их мне. ТОЛЬКО ОДНА KILL_ROUTE ОПЦИЯ
# МОЖЕТ БЫТЬ ИСПОЛЬЗОАНА ОДНОВРЕМЕННО, ТАК ЧТО
# НЕ РАСКОММЕНТИРУЙТЕ БОЛЬШЕ ОДНОЙ СТРОКИ.
#
# ЗАМЕЧАНИЕ: route команды это наименее оптимальная дорога блокирования
# и она не предоставляет полной защиты от UDP атак и
# будет спокойно создавать предупреждения для UDP и stealth сканирований.
# Я всегда рекомендую вам использовать пакетный фильтр, потому что это
# соответствует замыслу.
#
# Общий
#KILL_ROUTE="/sbin/route add $TARGET$ 333.444.555.666"
# Общий для Linux
#KILL_ROUTE="/sbin/route add -host $TARGET$ gw 333.444.555.666"
# Новые версии Linux поддерживают сейчас флаг reject. Это лучше, чем
# вышестоящая опция
KILL_ROUTE="/sbin/route add -host $TARGET$ reject"
# Общие для BSD (BSDI, OpenBSD, NetBSD, FreeBSD)
#KILL_ROUTE="/sbin/route add $TARGET$ 333.444.555.666"
# Общий для Sun
#KILL_ROUTE="/usr/sbin/route add $TARGET$ 333.444.555.666 1"
# NEXTSTEP
#KILL_ROUTE="/usr/etc/route add $TARGET$ 127.0.0.1 1"
# FreeBSD (Оттестировано не достаточно хорошо)
#KILL_ROUTE="route add -net $TARGET$ -netmask 255.255.255.255 127.0.0.1 -blackhole"
# Digital UNIX 4.0D (OSF/1 / Compaq Tru64 UNIX)
#KILL_ROUTE="/sbin/route add -host -blackhole $TARGET$ 127.0.0.1"
# Общие HP-UX
#KILL_ROUTE="/usr/sbin/route add net $TARGET$ netmask 255.255.255.0 127.0.0.1"
##
# Использование пакетного фильтра более предпочтительный метод. Ниже
# перечисленные строки подходят для многих ОС. Помните, вы можете
# раскомментировать только одну строку.
# Опции KILL_ROUTE.
##
###############
# TCP Wrappers#
###############
# Этот текст описывает внесение в файл hosts.deny для использования wrappers.
# Зжесь приводятся два формата TCP wrappers:
#
# Формат 1: Старый стиль - по умолчанию, когда хост не допускает обработки
# параметров.
#
KILL_HOSTS_DENY="ALL: $TARGET$"
#
# Формат 2: Новый стиль - включены расширенной обработки.
#  Вы можете просмотреть опции расширенной обработки, чтобы
# быть уверенными, что все перед символами "%" стоит символ "\"
# (например, \%c \%h )
#
#KILL_HOSTS_DENY="ALL: $TARGET$ : DENY"
###################
# Внешние команды #
###################
# Эта команда выполняется когда хост подключен, это может быть то, что вам
# нужно (пэйджер и т.д.). Эта команда выполняется перед очисткой маршрута.
# Я НЕ РЕКОМЕНДУЮ ПОМЕЩАТЬ КАКИЕ-ЛИБО КАРАТЕЛЬНЫЕ
# ДЕЙСТВИЯ ПРОТИВ ХОСТА СКАНИРУЮЩЕГО ВАС. TCP/IP это
# протокол без подтверждения подлинности и люди могут организовать
# сканирование из ниоткуда. Единственное, что можно безопасно запустить
# это скрипт обратной проверки, который использует классический -tcp режим.
# Этот режим требует полного соединения и очень труден для обмана (spoof).
#
#KILL_RUN_CMD="/some/path/here/script $TARGET$ $PORT$"
#####################
# Значение триггеров сканирования #
#####################
# Введите число соединений к портам, когда вам будет дано предупреждение.
# По умолчанию значение равно 0 - незамедлительная реакция.
# Значения 1 или 2 будут уменьшать количество ложных срабатываний. В более
# высоком значение нет необходимости. Это значение должно быть определено,
# но как правило можно оставить 0.
#
# ЗАМЕЧАНИЕ: Если вы используете продвинутые опции определения, вам
# нужно быть внимательным, чтобы не создать ситуацию "спускового крючка,
# требующего легкого нажатия". Поскольку расширенный режим будет
# реагировать на любой удаленный компьютер соединяющийся с интервалом
# ниже определенного здесь, вы при определенных обстоятельствах
# действительно разорвете что-нибудь. (например, кто-то невинно пытается
# соединиться с вами через SSL [TCP порт 443] и вы сразу блокируете его).
# Так что будьте внимательны.
#
SCAN_TRIGGER="0"
######################
# Секция заголовка (banner) порта  #
######################
#
# Введите здесь текст, который вы хотите показать человеку отключаемого
# PortSentry. Я не рекомендую насмехаться над человек, так как это может его
# разозлить. Оставьте эти строки закомментироваными, чтобы отключить эту
# возможность.
#
# Режим определения Stealth сканирования не использует эту возможность.
#
PORT_BANNER="** UNAUTHORIZED ACCESS PROHIBITED *** YOUR
CONNECTION ATTEMPT HAS
BEEN LOGGED. GO AWAY."
# EOF